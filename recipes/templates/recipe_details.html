{% extends "base.html" %}

{% block title %}
{% endblock title %}

{% block content %}
	<div class=" m-auto p-0">
		<div class="card-body col-lg-10 col-sm-11 m-auto">
			<br>
			<div class="row"> 
				<div class="col-lg-6 col-sm-11">
					<h3 class="text-center">{{recipe.name}}</h3>
					<p>Recipe by: {{recipe.owner}}</p>
					<p>"{{recipe.description}}"</p>
					<div class="">
						<a href="{% url 'export-recipe' recipe.slug %}" class="green-text btn btn-outline-peru"><i class="far fa-file-pdf"></i></a>
						{% if user == recipe.owner %}
							<a href="{% url 'update-recipe' recipe.slug %}" class="btn btn-outline-peru"><i class="far fa-edit"></i></a>
						{% elif user.isauthenticated %}
							<button class="btn btn-outline-peru" id="save-btn" onclick="save()">
								<i class="far fa-save
											{% if saved %}
												green-text
											{% else %}
												peru-text
											{% endif %}" ></i>
							</button>
						{% endif %}
					</div>
				</div>
				<div class="col-lg-6 col-sm-11">
					<img src="{{recipe.image.url}}" class="image-crop image-lg col-12">
				</div>
			</div>
		</div>
		<div class="row">
			<div class="col-lg-5">
				<h5 class="navbar-border pb-2 pl-4">
					Ingredients 
					<span class="float-right">
						Portion:<input type="number" id="portion" value="1" onkeyup="changeAmounts()">
					</span>
				</h5>
				<ul>
				{% for ingredient in recipe.ingredients.all %}
					 <li><span id="ingredient-amount-{{ingredient.id}}">{{ingredient.amount}}</span> {{ingredient.measure}} - {{ingredient.ingredient}}</li>
				{% endfor %}
				</ul>
			</div>
			<div class="col-lg-7">
			    <h5 class="navbar-border pb-2 pl-4">How to Make</h5>
			    <ol class="pr-4 text-justify">
				{% for instruction in recipe.instructions.all %}
					 <li>{{instruction.description}}</li>
					 <br>
				{% endfor %}
				</ol>
			</div>
		</div> 
	</div>
	<script type="text/javascript">
	function save() {
	    $.ajax(
	        {
	            type:'GET',
	            url: '{% url "save-recipe" recipe.id %}',
	            error: function(){
	                console.log('error');
	            },
	            success: function(data){
	            	console.log(data)
	            	if (data.saved){
	            		$("#save-btn").addClass("pink-text");
	            		$("#save-btn").removeClass("beige-text");
	            	}else{
	            		console.log("data")
	            		$("#save-btn").addClass("beige-text");
	            		$("#save-btn").removeClass("pink-text");
	            	}
	                
	            },
	        }
	    );
	}

	function changeAmounts(){
		portion = $("#portion").val();
		{% for ingredient in recipe.ingredients.all %}
			$("#ingredient-amount-{{ingredient.id}}").html({{ingredient.amount}}*portion);
		{% endfor %}
	}

	</script>
{% endblock content %}